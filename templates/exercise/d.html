{% extends 'base.html' %}

{% block content %}
<div class="relative">
    <div class="absolute top-3 right-3 bg-stone-100 rounded-lg shadow-md p-4 z-10">
        <div class="flex justify-end mb-1">
            <div class="text-indigo-800 font-semibold">
                <i class="fas fa-stopwatch mr-2"></i><span id="timer" class="text-xl">00:00</span>
            </div>
        </div>
       
        <div class="flex flex-col items-end space-y-2">
            <div class="text-indigo-800 font-semibold">
                <i class="fas fa-trophy mr-2"></i>Sequência: <span id="streak" class="text-xl">0</span>
            </div>
            <div class="text-green-400 font-semibold">
                <i class="fas fa-check-circle mr-2"></i>Acertos: <span id="correct" class="text-xl">0</span>
            </div>
            <div class="text-red-400 font-semibold">
                <i class="fas fa-times-circle mr-2"></i>Erros: <span id="incorrect" class="text-xl">0</span>
            </div>
        </div>
    </div>
</div>
<section class="bg-white rounded-lg shadow-md p-6 mt-10 relative">
    <div class="flex flex-col gap-3 items-center mb-6">
        <h2 class="text-2xl font-bold text-indigo-800 flex items-center">
            <i class="fas fa-headphones mr-3 text-indigo-600"></i>
            Desafio de Áudio e Imagem
        </h2>
        <button id="play-audio" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 transition duration-300 flex items-center">
            <i class="fas fa-volume-up text-xl mr-2"></i>
            Ouvir Termo
        </button>
    </div>
   
    <div id="exercise-area" class="mb-6 flex flex-col justify-center items-center place-items-center">
        <div class="grid grid-cols-2 gap-4 mb-6 place-items-center">
            <div id="image-option-1" class="p-2 rounded-lg cursor-pointer hover:bg-gray-300 transition duration-300 w-fit">
            </div>
            <div id="image-option-2" class="p-2 rounded-lg cursor-pointer hover:bg-gray-300 transition duration-300 w-fit">
            </div>
            <div id="image-option-3" class="p-2 rounded-lg cursor-pointer hover:bg-gray-300 transition duration-300 w-fit">
            </div>
            <div id="image-option-4" class="p-2 rounded-lg cursor-pointer hover:bg-gray-300 transition duration-300 w-fit">
            </div>
          </div>
        <div class="flex justify-center space-x-4 mb-4">
            <button id="check-answer" class="bg-indigo-600 text-white px-6 py-2 rounded-md hover:bg-indigo-700 transition duration-300 flex items-center">
                <i class="fas fa-check mr-2"></i> Verificar
            </button>
            <button id="skip-exercise" class="bg-yellow-500 text-white px-6 py-2 rounded-md hover:bg-yellow-600 transition duration-300 flex items-center">
                <i class="fas fa-forward mr-2"></i> Pular
            </button>
        </div>
        <div id="result-message" class="text-center font-bold mt-4"></div>
    </div>
    <div class="absolute bottom-4 left-4 cursor-pointer" id="help-icon">
        <i class="fas fa-question-circle text-2xl text-indigo-600"></i>
    </div>
    <div id="help-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <h3 class="text-lg leading-6 font-medium text-gray-900">Como jogar</h3>
                <div class="mt-2 px-7 py-3">
                    <ol class="list-decimal list-inside text-gray-700 text-left">
                        <li>Clique em "Ouvir Termo" para reproduzir o áudio</li>
                        <li>Escolha a imagem que corresponde ao termo ouvido</li>
                        <li>Verifique sua resposta ou passe para o próximo desafio</li>
                    </ol>
                </div>
                <div class="items-center px-4 py-3">
                    <button id="close-modal" class="px-4 py-2 bg-indigo-600 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        Fechar
                    </button>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block script %}
<script>
    // Variáveis globais
    let currentExercise;
    let selectedImage;
    let streak = 0;
    let correctAnswers = 0;
    let incorrectAnswers = 0;
    let timerInterval;
    let seconds = 0;

    // Elementos do DOM
    const playAudioBtn = document.getElementById('play-audio');
    const checkAnswerBtn = document.getElementById('check-answer');
    const skipExerciseBtn = document.getElementById('skip-exercise');
    const exerciseArea = document.getElementById('exercise-area');
    const resultMessage = document.getElementById('result-message');
    const timerElement = document.getElementById('timer');
    const streakElement = document.getElementById('streak');
    const correctElement = document.getElementById('correct');
    const incorrectElement = document.getElementById('incorrect');
    const helpIcon = document.getElementById('help-icon');
    const helpModal = document.getElementById('help-modal');
    const closeModalBtn = document.getElementById('close-modal');

    // Exercícios de exemplo (substitua por seus próprios exercícios)
    const exercises = [
        { audio: 'path/to/audio1.mp3', correctImage: 1, images: ['https://upload.wikimedia.org/wikipedia/commons/2/27/Square_200x200.svg', 'https://upload.wikimedia.org/wikipedia/commons/2/27/Square_200x200.svg', 'https://upload.wikimedia.org/wikipedia/commons/2/27/Square_200x200.svg', 'https://upload.wikimedia.org/wikipedia/commons/2/27/Square_200x200.svg'] },
        { audio: 'path/to/audio2.mp3', correctImage: 2, images: ['https://upload.wikimedia.org/wikipedia/commons/2/27/Square_200x200.svg', 'https://upload.wikimedia.org/wikipedia/commons/2/27/Square_200x200.svg', 'https://upload.wikimedia.org/wikipedia/commons/2/27/Square_200x200.svg', 'https://upload.wikimedia.org/wikipedia/commons/2/27/Square_200x200.svg'] },
        // Adicione mais exercícios aqui
    ];

    // Funções
    function loadNextExercise() {
        currentExercise = exercises[Math.floor(Math.random() * exercises.length)];
        selectedImage = null;
        resultMessage.textContent = '';
        resultMessage.classList.remove('text-green-500', 'text-red-500');

        for (let i = 1; i <= 4; i++) {
            const imageElement = document.getElementById(`image-option-${i}`);
            imageElement.innerHTML = `<img src="${currentExercise.images[i-1]}" alt="Opção ${i}"">`;
            imageElement.classList.remove('border-4', 'border-indigo-600');
            imageElement.onclick = () => selectImage(i);
        }
    }

    function selectImage(imageNumber) {
        selectedImage = imageNumber;
        for (let i = 1; i <= 4; i++) {
            const imageElement = document.getElementById(`image-option-${i}`);
            if (i === imageNumber) {
                imageElement.classList.add('border-4', 'border-indigo-400', 'bg-gray-300');
            } else {
                imageElement.classList.remove('border-4', 'border-indigo-400', 'bg-gray-300');
            }
        }
    }

    function checkAnswer() {
        if (selectedImage === null) {
            resultMessage.textContent = 'Por favor, selecione uma imagem antes de verificar.';
            resultMessage.classList.add('text-yellow-500');
            return;
        }

        if (selectedImage === currentExercise.correctImage) {
            resultMessage.textContent = 'Correto!';
            resultMessage.classList.add('text-green-500');
            streak++;
            correctAnswers++;
        } else {
            resultMessage.textContent = 'Incorreto. Tente novamente!';
            resultMessage.classList.add('text-red-500');
            streak = 0;
            incorrectAnswers++;
        }

        updateStats();
        setTimeout(loadNextExercise, 1500);
    }

    function updateStats() {
        streakElement.textContent = streak;
        correctElement.textContent = correctAnswers;
        incorrectElement.textContent = incorrectAnswers;
    }

    function startTimer() {
        timerInterval = setInterval(() => {
            seconds++;
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
        }, 1000);
    }

    function playAudio() {
        // Implemente a lógica de reprodução de áudio aqui
        console.log('Reproduzindo áudio:', currentExercise.audio);
    }

    // Event Listeners
    playAudioBtn.addEventListener('click', playAudio);
    checkAnswerBtn.addEventListener('click', checkAnswer);
    skipExerciseBtn.addEventListener('click', loadNextExercise);
    helpIcon.addEventListener('click', () => helpModal.classList.remove('hidden'));
    closeModalBtn.addEventListener('click', () => helpModal.classList.add('hidden'));

    // Inicialização
    loadNextExercise();
    startTimer();
</script>
{% endblock %}