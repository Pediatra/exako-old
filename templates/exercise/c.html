{% extends 'base.html' %}

{% block content %}
<div class="relative">
    <div class="absolute top-3 right-3 bg-stone-100 rounded-lg shadow-md p-4 z-10">
        <div class="flex justify-end mb-1">
            <div class="text-indigo-800 font-semibold">
                <i class="fas fa-stopwatch mr-2"></i><span id="timer" class="text-xl">00:00</span>
            </div>
        </div>
       
        <div class="flex flex-col items-end space-y-2">
            <div class="text-indigo-800 font-semibold">
                <i class="fas fa-trophy mr-2"></i>Sequência: <span id="streak" class="text-xl">0</span>
            </div>
            <div class="text-green-400 font-semibold">
                <i class="fas fa-check-circle mr-2"></i>Acertos: <span id="correct" class="text-xl">0</span>
            </div>
            <div class="text-red-400 font-semibold">
                <i class="fas fa-times-circle mr-2"></i>Erros: <span id="incorrect" class="text-xl">0</span>
            </div>
        </div>
    </div>
</div>

<section class="bg-white rounded-lg shadow-md p-6 mt-10 relative">
    <div class="flex flex-col gap-3 items-center mb-6">
        <h2 class="text-2xl font-bold text-indigo-800 flex items-center">
            <i class="fas fa-question-circle mr-3 text-indigo-600"></i>
            Desafio de Múltipla Escolha
        </h2>
    </div>
   
    <div id="exercise-area" class="mb-6 pt-10">
        <h3 id="question" class="text-lg font-semibold text-indigo-800"></h3>
        <div id="options" class="grid grid-cols-2 gap-4 mb-6 pt-10">
        </div>
        <div class="flex justify-center space-x-4 mb-4">
            <button id="check-answer" class="bg-indigo-600 text-white px-6 py-2 rounded-md hover:bg-indigo-700 transition duration-300 flex items-center">
                <i class="fas fa-check mr-2"></i> Verificar
            </button>
            <button id="next-question" class="bg-yellow-500 text-white px-6 py-2 rounded-md hover:bg-yellow-600 transition duration-300 flex items-center">
                <i class="fas fa-forward mr-2"></i> Pular
            </button>
        </div>
       
        <div id="result-message" class="text-center font-bold mt-4"></div>
    </div>

    <div class="absolute bottom-4 left-4 cursor-pointer" id="help-icon">
        <i class="fas fa-question-circle text-2xl text-indigo-600"></i>
    </div>

    <div id="help-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <h3 class="text-lg leading-6 font-medium text-gray-900">Como jogar</h3>
                <div class="mt-2 px-7 py-3">
                    <ol class="list-decimal list-inside text-gray-700 text-left">
                        <li>Leia a pergunta cuidadosamente</li>
                        <li>Escolha uma das quatro opções de resposta</li>
                        <li>Clique em "Verificar" para conferir sua resposta</li>
                        <li>Use "Próxima Pergunta" para avançar</li>
                    </ol>
                </div>
                <div class="items-center px-4 py-3">
                    <button id="close-modal" class="px-4 py-2 bg-indigo-600 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        Fechar
                    </button>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block script %}
<script>
    // Variáveis globais
    let currentQuestion = null;
    let timer = 0;
    let streak = 0;
    let correct = 0;
    let incorrect = 0;
    let timerInterval;

    // Elementos do DOM
    const questionElement = document.getElementById('question');
    const optionsElement = document.getElementById('options');
    const checkAnswerButton = document.getElementById('check-answer');
    const nextQuestionButton = document.getElementById('next-question');
    const resultMessage = document.getElementById('result-message');
    const timerDisplay = document.getElementById('timer');
    const streakDisplay = document.getElementById('streak');
    const correctDisplay = document.getElementById('correct');
    const incorrectDisplay = document.getElementById('incorrect');
    const helpIcon = document.getElementById('help-icon');
    const helpModal = document.getElementById('help-modal');
    const closeModalButton = document.getElementById('close-modal');

    // Perguntas de exemplo (substitua por sua própria lógica de obtenção de perguntas)
    const questions = [
        {
            question: "Qual é a capital da França?",
            options: ["Londres", "Berlim", "Madrid", "Paris"],
            correctAnswer: 3
        },
        {
            question: "Quem pintou a Mona Lisa?",
            options: ["Vincent van Gogh", "Leonardo da Vinci", "Pablo Picasso", "Michelangelo"],
            correctAnswer: 1
        },
        {
            question: "Qual é o maior planeta do sistema solar?",
            options: ["Marte", "Vênus", "Júpiter", "Saturno"],
            correctAnswer: 2
        }
    ];

    // Funções
    function loadQuestion() {
        currentQuestion = questions[Math.floor(Math.random() * questions.length)];
        questionElement.textContent = currentQuestion.question;
        optionsElement.innerHTML = '';
        currentQuestion.options.forEach((option, index) => {
            const button = document.createElement('button');
            button.textContent = option;
            button.className = 'option p-4 text-left rounded-lg transition duration-300 bg-gray-100 hover:bg-indigo-100';
            button.onclick = () => selectOption(index);
            optionsElement.appendChild(button);
        });
        resultMessage.textContent = '';
        checkAnswerButton.disabled = true;
    }

    function selectOption(index) {
        optionsElement.querySelectorAll('button').forEach((button, i) => {
            button.classList.toggle('bg-indigo-200', i === index);
            button.classList.toggle('bg-white', i !== index);
        });
        checkAnswerButton.disabled = false;
    }

    function checkAnswer() {
        const selectedIndex = Array.from(optionsElement.children).findIndex(button => 
            button.classList.contains('bg-indigo-200')
        );
        if (selectedIndex === currentQuestion.correctAnswer) {
            correct++;
            streak++;
            resultMessage.textContent = 'Correto!';
            resultMessage.className = 'text-center font-bold mt-4 text-green-500';
        } else {
            incorrect++;
            streak = 0;
            resultMessage.textContent = `Incorreto. A resposta correta era: ${currentQuestion.options[currentQuestion.correctAnswer]}`;
            resultMessage.className = 'text-center font-bold mt-4 text-red-500';
        }
        updateStats();
        checkAnswerButton.disabled = true;
        nextQuestionButton.disabled = false;
    }

    function startTimer() {
        timerInterval = setInterval(() => {
            timer++;
            updateTimer();
        }, 1000);
    }

    function updateTimer() {
        const minutes = Math.floor(timer / 60);
        const seconds = timer % 60;
        timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }

    function updateStats() {
        streakDisplay.textContent = streak;
        correctDisplay.textContent = correct;
        incorrectDisplay.textContent = incorrect;
    }

    // Inicialização
    loadQuestion();
    startTimer();

    // Event Listeners
    checkAnswerButton.addEventListener('click', checkAnswer);
    nextQuestionButton.addEventListener('click', loadQuestion);
    helpIcon.addEventListener('click', () => helpModal.classList.remove('hidden'));
    closeModalButton.addEventListener('click', () => helpModal.classList.add('hidden'));

    // Fechar o modal ao clicar fora dele
    window.addEventListener('click', (event) => {
        if (event.target === helpModal) {
            helpModal.classList.add('hidden');
        }
    });
</script>
{% endblock %}