{% extends 'base.html' %}

{% block content %}
<div class="relative">
    <div class="absolute top-3 right-3 bg-stone-100 rounded-lg shadow-md p-4 z-10">
        <div class="flex justify-end mb-1">
            <div class="text-indigo-800 font-semibold">
                <i class="fas fa-stopwatch mr-2"></i><span id="timer" class="text-xl">00:00</span>
            </div>
        </div>
       
        <div class="flex flex-col items-end space-y-2">
            <div class="text-indigo-800 font-semibold">
                <i class="fas fa-trophy mr-2"></i>Sequência: <span id="streak" class="text-xl">0</span>
            </div>
            <div class="text-green-400 font-semibold">
                <i class="fas fa-check-circle mr-2"></i>Acertos: <span id="correct" class="text-xl">0</span>
            </div>
            <div class="text-red-400 font-semibold">
                <i class="fas fa-times-circle mr-2"></i>Erros: <span id="incorrect" class="text-xl">0</span>
            </div>
        </div>
    </div>
</div>

<section class="bg-white rounded-lg shadow-md p-6 mt-10 relative">
    <div class="flex flex-col gap-3 items-center mb-6">
        <h2 class="text-2xl font-bold text-indigo-800 flex items-center">
            <i class="fas fa-headphones mr-3 text-indigo-600"></i>
            Desafio de Audição e Digitação
        </h2>
        <button id="play-audio" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 transition duration-300 flex items-center">
            <i class="fas fa-volume-up text-xl mr-2"></i>
            Ouvir Palavra
        </button>
    </div>
   
    <div id="exercise-area" class="mb-6">
        <div class="p-6 rounded-lg mb-6">
            <h3 class="text-lg font-semibold text-indigo-800 mb-3">Digite a palavra que você ouviu:</h3>
            <input type="text" id="user-input" class="w-full p-2 border rounded bg-stone-200 focus:ring-indigo-500 focus:border-indigo-500" placeholder="Digite aqui...">
        </div>
       
        <div class="flex justify-center space-x-4 mb-4">
            <button id="check-answer" class="bg-indigo-600 text-white px-6 py-2 rounded-md hover:bg-indigo-700 transition duration-300 flex items-center">
                <i class="fas fa-check mr-2"></i> Verificar
            </button>
            <button id="skip-exercise" class="bg-yellow-500 text-white px-6 py-2 rounded-md hover:bg-yellow-600 transition duration-300 flex items-center">
                <i class="fas fa-forward mr-2"></i> Pular exercício
            </button>
        </div>
       
        <div id="result-message" class="text-center font-bold mt-4"></div>
    </div>

    <div class="absolute bottom-4 left-4 cursor-pointer" id="help-icon">
        <i class="fas fa-question-circle text-2xl text-indigo-600"></i>
    </div>

    <div id="help-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <h3 class="text-lg leading-6 font-medium text-gray-900">Como jogar</h3>
                <div class="mt-2 px-7 py-3">
                    <ol class="list-decimal list-inside text-gray-700 text-left">
                        <li>Clique em "Ouvir Palavra" para escutar a pronúncia</li>
                        <li>Digite a palavra que você ouviu no campo de texto</li>
                        <li>Clique em "Verificar" para conferir sua resposta</li>
                        <li>Use "Pular" se quiser passar para a próxima palavra</li>
                    </ol>
                </div>
                <div class="items-center px-4 py-3">
                    <button id="close-modal" class="px-4 py-2 bg-indigo-600 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        Fechar
                    </button>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block script %}
<script>
    // Variáveis globais
    let currentWord = '';
    let timer = 0;
    let streak = 0;
    let correct = 0;
    let incorrect = 0;
    let timerInterval;

    // Elementos do DOM
    const playAudioButton = document.getElementById('play-audio');
    const userInput = document.getElementById('user-input');
    const checkAnswerButton = document.getElementById('check-answer');
    const skipExerciseButton = document.getElementById('skip-exercise');
    const resultMessage = document.getElementById('result-message');
    const timerDisplay = document.getElementById('timer');
    const streakDisplay = document.getElementById('streak');
    const correctDisplay = document.getElementById('correct');
    const incorrectDisplay = document.getElementById('incorrect');
    const helpIcon = document.getElementById('help-icon');
    const helpModal = document.getElementById('help-modal');
    const closeModalButton = document.getElementById('close-modal');

    // Palavras de exemplo (substitua por sua própria lógica de obtenção de palavras)
    const words = ['hello', 'world', 'exercise', 'language', 'practice'];

    // Funções
    function nextWord() {
        currentWord = words[Math.floor(Math.random() * words.length)];
        userInput.value = '';
        resultMessage.textContent = '';
    }

    function playAudio() {
        // Simular a reprodução do áudio (substitua por sua própria lógica de reprodução de áudio)
        const utterance = new SpeechSynthesisUtterance(currentWord);
        speechSynthesis.speak(utterance);
    }

    function checkAnswer() {
        if (userInput.value.toLowerCase().trim() === currentWord.toLowerCase()) {
            correct++;
            streak++;
            resultMessage.textContent = 'Correto!';
            resultMessage.className = 'text-center font-bold mt-4 text-green-500';
        } else {
            incorrect++;
            streak = 0;
            resultMessage.textContent = `Incorreto. A palavra correta era: ${currentWord}`;
            resultMessage.className = 'text-center font-bold mt-4 text-red-500';
        }
        updateStats();
        setTimeout(nextWord, 2000);
    }

    function startTimer() {
        timerInterval = setInterval(() => {
            timer++;
            updateTimer();
        }, 1000);
    }

    function updateTimer() {
        const minutes = Math.floor(timer / 60);
        const seconds = timer % 60;
        timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }

    function updateStats() {
        streakDisplay.textContent = streak;
        correctDisplay.textContent = correct;
        incorrectDisplay.textContent = incorrect;
    }

    // Inicialização
    nextWord();
    startTimer();

    // Event Listeners
    playAudioButton.addEventListener('click', playAudio);
    checkAnswerButton.addEventListener('click', checkAnswer);
    skipExerciseButton.addEventListener('click', nextWord);
    helpIcon.addEventListener('click', () => helpModal.classList.remove('hidden'));
    closeModalButton.addEventListener('click', () => helpModal.classList.add('hidden'));

    // Fechar o modal ao clicar fora dele
    window.addEventListener('click', (event) => {
        if (event.target === helpModal) {
            helpModal.classList.add('hidden');
        }
    });
</script>
{% endblock %}